<!DOCTYPE html>
<html lang="zh_CN">
    <!-- title -->




<!-- keywords -->




<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" >
    <meta name="author" content="Kealdishx">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="Kealdishx">
    
    <meta name="keywords" content="ios,hexo,hexo-blog">
    
    <meta name="description" content="Just focus">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <title>Mach-O 文件解析 · Kealdish&#39;s Studio</title>
    <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/font/Oswald-Regular.ttf");
    }

    body {
        margin: 0;
    }

    header,
    footer,
    .back-top,
    .sidebar,
    .container,
    .site-intro-meta,
    .toc-wrapper {
        display: none;
    }

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(-45deg, #444 0, #444 80px, #333 80px, #333 160px);
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s infinite;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }

</style>

    <link rel="preload" href= "/css/style.css?v=20180824" as="style" onload="this.onload=null;this.rel='stylesheet'" />
    <link rel="stylesheet" href= "/css/mobile.css?v=20180824" media="(max-width: 980px)">
    
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'" />
    
    <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
(function( w ){
	"use strict";
	// rel=preload support test
	if( !w.loadCSS ){
		w.loadCSS = function(){};
	}
	// define on the loadCSS obj
	var rp = loadCSS.relpreload = {};
	// rel=preload feature support test
	// runs once and returns a function for compat purposes
	rp.support = (function(){
		var ret;
		try {
			ret = w.document.createElement( "link" ).relList.supports( "preload" );
		} catch (e) {
			ret = false;
		}
		return function(){
			return ret;
		};
	})();

	// if preload isn't supported, get an asynchronous load by using a non-matching media attribute
	// then change that media back to its intended value on load
	rp.bindMediaToggle = function( link ){
		// remember existing media attr for ultimate state, or default to 'all'
		var finalMedia = link.media || "all";

		function enableStylesheet(){
			link.media = finalMedia;
		}

		// bind load handlers to enable media
		if( link.addEventListener ){
			link.addEventListener( "load", enableStylesheet );
		} else if( link.attachEvent ){
			link.attachEvent( "onload", enableStylesheet );
		}

		// Set rel and non-applicable media type to start an async request
		// note: timeout allows this to happen async to let rendering continue in IE
		setTimeout(function(){
			link.rel = "stylesheet";
			link.media = "only x";
		});
		// also enable media after 3 seconds,
		// which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
		setTimeout( enableStylesheet, 3000 );
	};

	// loop through link elements in DOM
	rp.poly = function(){
		// double check this to prevent external calls from running
		if( rp.support() ){
			return;
		}
		var links = w.document.getElementsByTagName( "link" );
		for( var i = 0; i < links.length; i++ ){
			var link = links[ i ];
			// qualify links to those with rel=preload and as=style attrs
			if( link.rel === "preload" && link.getAttribute( "as" ) === "style" && !link.getAttribute( "data-loadcss" ) ){
				// prevent rerunning on link
				link.setAttribute( "data-loadcss", true );
				// bind listeners to toggle media back
				rp.bindMediaToggle( link );
			}
		}
	};

	// if unsupported, run the polyfill
	if( !rp.support() ){
		// run once at least
		rp.poly();

		// rerun poly on an interval until onload
		var run = w.setInterval( rp.poly, 500 );
		if( w.addEventListener ){
			w.addEventListener( "load", function(){
				rp.poly();
				w.clearInterval( run );
			} );
		} else if( w.attachEvent ){
			w.attachEvent( "onload", function(){
				rp.poly();
				w.clearInterval( run );
			} );
		}
	}


	// commonjs
	if( typeof exports !== "undefined" ){
		exports.loadCSS = loadCSS;
	}
	else {
		w.loadCSS = loadCSS;
	}
}( typeof global !== "undefined" ? global : this ) );
</script>

    <link rel="icon" href= "/assets/favicon.ico" />
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js" as="script" />
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" as="script" />
    <link rel="preload" href="/scripts/main.js" as="script" />
    <link rel="preload" as="font" href="/font/Oswald-Regular.ttf" crossorigin>
    <link rel="preload" as="font" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff" crossorigin>
    
    <!-- fancybox -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" defer></script>
    <!-- 百度统计  -->
    
    <!-- 谷歌统计  -->
    
</head>

    
        <body class="post-body">
    
    
<header class="header">

    <div class="read-progress"></div>
    <div class="header-sidebar-menu">&#xe775;</div>
    <!-- post页的toggle banner  -->
    
    <div class="banner">
            <div class="blog-title">
                <a href="/" >Kealdish&#39;s Studio.</a>
            </div>
            <div class="post-title">
                <a href="#" class="post-name">Mach-O 文件解析</a>
            </div>
    </div>
    
    <a class="home-link" href=/>Kealdish's Studio.</a>
</header>
    <div class="wrapper">
        <div class="site-intro" style="







height:50vh;
">
    
    <!-- 主页  -->
    
    
    <!-- 404页  -->
            
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-img" style="background-image: url(/intro/post-bg.jpg)"></div>
    <div class="site-intro-meta">
        <!-- 标题  -->
        <h1 class="intro-title">
            <!-- 主页  -->
            
            Mach-O 文件解析
            <!-- 404 -->
            
        </h1>
        <!-- 副标题 -->
        <p class="intro-subtitle">
            <!-- 主页副标题  -->
            
            
            <!-- 404 -->
            
        </p>
        <!-- 文章页meta -->
        
            <div class="post-intros">
                <!-- 文章页标签  -->
                
                
                    <div class="post-intro-read">
                        <span>字数统计: <span class="post-count word-count">3.6k</span>阅读时长: <span class="post-count reading-time">16 min</span></span>
                    </div>
                
                <div class="post-intro-meta">
                    <span class="post-intro-calander iconfont-archer">&#xe676;</span>
                    <span class="post-intro-time">2018/11/10</span>
                    
                    <span class="shareWrapper">
                        <span class="iconfont-archer shareIcon">&#xe71d;</span>
                        <span class="shareText">Share</span>
                        <ul class="shareList">
                            <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                                <div class="share-qrcode"></div>
                            </li>
                            <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                            <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                            <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                            <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                        </ul>
                    </span>
                </div>
            </div>
        
    </div>
</div>
        <script>
 
  // get user agent
  var browser = {
    versions: function () {
      var u = window.navigator.userAgent;
      return {
        userAgent: u,
        trident: u.indexOf('Trident') > -1, //IE内核
        presto: u.indexOf('Presto') > -1, //opera内核
        webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
        gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
        mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
        ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
        android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
        iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者安卓QQ浏览器
        iPad: u.indexOf('iPad') > -1, //是否为iPad
        webApp: u.indexOf('Safari') == -1, //是否为web应用程序，没有头部与底部
        weixin: u.indexOf('MicroMessenger') == -1, //是否为微信浏览器
        uc: u.indexOf('UCBrowser') > -1 //是否为android下的UC浏览器
      };
    }()
  }
  console.log("userAgent:" + browser.versions.userAgent);

  // callback
  function fontLoaded() {
    console.log('font loaded');
    if (document.getElementsByClassName('site-intro-meta')) {
      document.getElementsByClassName('intro-title')[0].classList.add('intro-fade-in');
      document.getElementsByClassName('intro-subtitle')[0].classList.add('intro-fade-in');
      var postIntros = document.getElementsByClassName('post-intros')[0]
      if (postIntros) {
        postIntros.classList.add('post-fade-in');
      }
    }
  }

  // UC不支持跨域，所以直接显示
  function asyncCb(){
    if (browser.versions.uc) {
      console.log("UCBrowser");
      fontLoaded();
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular']
        },
        loading: function () {  //所有字体开始加载
          // console.log('loading');
        },
        active: function () {  //所有字体已渲染
          fontLoaded();
        },
        inactive: function () { //字体预加载失败，无效字体或浏览器不支持加载
          console.log('inactive: timeout');
          fontLoaded();
        },
        timeout: 5000 // Set the timeout to two seconds
      });
    }
  }

  function asyncErr(){
    console.warn('script load from CDN failed, will load local script')
  }

  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (cb) { o.addEventListener('load', function (e) { cb(null, e); }, false); }
    if (err) { o.addEventListener('error', function (e) { err(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }

  var asyncLoadWithFallBack = function(arr, success, reject) {
      var currReject = function(){
        reject()
        arr.shift()
        if(arr.length)
          async(arr[0], success, currReject)
        }

      async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack([
    "https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js", 
    "https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js",
    "/lib/webfontloader.min.js"
  ], asyncCb, asyncErr)
</script>        
        <img class="loading" src="/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" />
        <div class="container container-unloaded">
            <main class="main post-page">
    <article class="article-entry">
        <h3 id="0x00-概要"><a href="#0x00-概要" class="headerlink" title="0x00 概要"></a>0x00 概要</h3><p><code>Mach-O</code> 是 <code>Mach object</code> 文件格式的缩写，它是一种用于记录可执行文件、对象代码、共享库、动态加载代码和内存转储的文件格式。作为 <code>a.out</code> 格式的替代品， <code>Mach-O</code> 提供了更好的扩展性，并提升了符号表中信息的访问速度。</p>
<p>每个 <code>Mach-O</code> 文件都包含一个 <code>Mach-O</code> 头，然后是载入命令(<code>Load Commands</code>),最后是数据块(<code>Data</code>)。</p>
<p><img src="/images/macho/macho.jpg" alt=""></p>
<a id="more"></a>
<ul>
<li>Header : 保存了 <code>Mach-O</code> 的一些基本信息，包括了平台、文件类型、 <code>LoadCommands</code> 的个数等等。</li>
<li>LoadCommands：这一段紧跟 <code>Header</code> ，加载 <code>Mach-O</code> 文件时会使用这里的数据来确定内存的分布。</li>
<li>Data：每一个 <code>segment</code> 的具体数据都保存在这里，这里包含了具体的代码、数据等等。</li>
</ul>
<p><strong>注意</strong>：如果是一个 Fat <code>Mach-O</code> 文件，则它的结构会稍有不同，会多出一个 <code>Fat Header</code> 。</p>
<p>为了更好地说明 <code>Mach-O</code> 的文件格式，下面会借助于 <a href="https://sourceforge.net/projects/machoview/" target="_blank" rel="external">MachOView</a> 来展示其内部的结构。</p>
<p><img src="/images/macho/machoOverview.jpg" alt=""></p>
<h3 id="0x01-Fat-Header"><a href="#0x01-Fat-Header" class="headerlink" title="0x01 Fat Header"></a>0x01 Fat Header</h3><p><code>Fat Header</code> 的定义如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mach/machine.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> FAT_MAGIC	0xcafebabe</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> FAT_CIGAM	0xbebafeca	</span></div><div class="line"></div><div class="line"><span class="keyword">struct</span> fat_header &#123;</div><div class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span>	magic;		<span class="comment">/* FAT_MAGIC */</span></div><div class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span>	nfat_arch;	<span class="comment">/* number of structs that follow */</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">struct</span> fat_arch &#123;</div><div class="line">	<span class="keyword">cpu_type_t</span>	cputype;	<span class="comment">/* cpu specifier (int) */</span></div><div class="line">	<span class="keyword">cpu_subtype_t</span>	cpusubtype;	<span class="comment">/* machine specifier (int) */</span></div><div class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span>	offset;		<span class="comment">/* file offset to this object file */</span></div><div class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span>	size;		<span class="comment">/* size of this object file */</span></div><div class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span>	align;		<span class="comment">/* alignment as a power of 2 */</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> KERNEL</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mach/mach_types.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">struct</span> vnode;</div><div class="line"></div><div class="line"><span class="comment">/* XXX return type should be load_return_t, but mach_loader.h is not in scope */</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">fatfile_getarch_affinity</span><span class="params">(<span class="keyword">struct</span> vnode *vp, <span class="keyword">vm_offset_t</span> data_ptr,</span></span></div><div class="line">		<span class="keyword">struct</span> fat_arch *archret, <span class="keyword">int</span> affinity);</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">fatfile_getarch</span><span class="params">(<span class="keyword">struct</span> vnode *vp, <span class="keyword">vm_offset_t</span> data_ptr,</span></span></div><div class="line">		<span class="keyword">struct</span> fat_arch *archret);</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">fatfile_getarch_with_bits</span><span class="params">(<span class="keyword">struct</span> vnode *vp, <span class="keyword">integer_t</span> archbits,</span></span></div><div class="line">		<span class="keyword">vm_offset_t</span> data_ptr, <span class="keyword">struct</span> fat_arch *archret);</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span>	<span class="comment">/* KERNEL */</span></span></div></pre></td></tr></table></figure>
<p>由代码定义我们可以看出 <code>fat_header</code> 主要包含两部分：</p>
<ul>
<li><code>magic</code> : 标识当前文件是 Fat <code>Mach-O</code> 文件</li>
<li><code>nfat_arch</code> : 当前文件中包含的架构的数目</li>
</ul>
<h3 id="0x02-Header"><a href="#0x02-Header" class="headerlink" title="0x02 Header"></a>0x02 Header</h3><p><code>Header</code> 的定义如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line"> * The 32-bit mach header appears at the very beginning of the object file for</div><div class="line"> * 32-bit architectures.</div><div class="line"> */</div><div class="line"><span class="keyword">struct</span> mach_header &#123;</div><div class="line">	<span class="keyword">uint32_t</span>	magic;		<span class="comment">/* mach magic number identifier */</span></div><div class="line">	<span class="keyword">cpu_type_t</span>	cputype;	<span class="comment">/* cpu specifier */</span></div><div class="line">	<span class="keyword">cpu_subtype_t</span>	cpusubtype;	<span class="comment">/* machine specifier */</span></div><div class="line">	<span class="keyword">uint32_t</span>	filetype;	<span class="comment">/* type of file */</span></div><div class="line">	<span class="keyword">uint32_t</span>	ncmds;		<span class="comment">/* number of load commands */</span></div><div class="line">	<span class="keyword">uint32_t</span>	sizeofcmds;	<span class="comment">/* the size of all the load commands */</span></div><div class="line">	<span class="keyword">uint32_t</span>	flags;		<span class="comment">/* flags */</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">/* Constant for the magic field of the mach_header (32-bit architectures) */</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span>	MH_MAGIC	0xfeedface	<span class="comment">/* the mach magic number */</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MH_CIGAM	0xcefaedfe	<span class="comment">/* NXSwapInt(MH_MAGIC) */</span></span></div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"> * The 64-bit mach header appears at the very beginning of object files for</div><div class="line"> * 64-bit architectures.</div><div class="line"> */</div><div class="line"><span class="keyword">struct</span> mach_header_64 &#123;</div><div class="line">	<span class="keyword">uint32_t</span>	magic;		<span class="comment">/* mach magic number identifier */</span></div><div class="line">	<span class="keyword">cpu_type_t</span>	cputype;	<span class="comment">/* cpu specifier */</span></div><div class="line">	<span class="keyword">cpu_subtype_t</span>	cpusubtype;	<span class="comment">/* machine specifier */</span></div><div class="line">	<span class="keyword">uint32_t</span>	filetype;	<span class="comment">/* type of file */</span></div><div class="line">	<span class="keyword">uint32_t</span>	ncmds;		<span class="comment">/* number of load commands */</span></div><div class="line">	<span class="keyword">uint32_t</span>	sizeofcmds;	<span class="comment">/* the size of all the load commands */</span></div><div class="line">	<span class="keyword">uint32_t</span>	flags;		<span class="comment">/* flags */</span></div><div class="line">	<span class="keyword">uint32_t</span>	reserved;	<span class="comment">/* reserved */</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">/* Constant for the magic field of the mach_header_64 (64-bit architectures) */</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MH_MAGIC_64 0xfeedfacf <span class="comment">/* the 64-bit mach magic number */</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MH_CIGAM_64 0xcffaedfe <span class="comment">/* NXSwapInt(MH_MAGIC_64) */</span></span></div></pre></td></tr></table></figure>
<p>由源码可以看出 <code>Header</code> 的主要作用就是帮助系统迅速的定位 <code>Mach-O</code> 文件的运行环境，文件类型。</p>
<p><img src="/images/macho/header.jpg" alt=""></p>
<p>由此我们可以看出 <code>Header</code> 主要由以下几部分组成：</p>
<ul>
<li><code>magic number</code> : 确定是 32 位还是 64 位平台上的文件。 <code>0xfeedfacf</code> 代表 64 位， <code>0xfeedface</code> 代表 32 位。</li>
<li><code>CPU type</code> <code>CPU subtype</code> : 确定文件运行的 CPU 架构，这里是 x86_64 架构。</li>
<li><code>File Type</code> : 标识文件的类型。它所有的值定义如下：</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span>	MH_OBJECT	0x1		<span class="comment">/* relocatable object file */</span>  <span class="comment">//  编译过程中产生的*.obj文件 </span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span>	MH_EXECUTE	0x2		<span class="comment">/* demand paged executable file */</span>  <span class="comment">// 可执行二进制文件</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span>	MH_FVMLIB	0x3		<span class="comment">/* fixed VM shared library file */</span> </span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span>	MH_CORE		0x4		<span class="comment">/* core file */</span>      <span class="comment">//  崩溃时的Dump文件 </span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span>	MH_PRELOAD	0x5		<span class="comment">/* preloaded executable file */</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span>	MH_DYLIB	0x6		<span class="comment">/* dynamically bound shared library */</span>  <span class="comment">// 动态库</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span>	MH_DYLINKER	0x7		<span class="comment">/* dynamic link editor */</span>    <span class="comment">// 动态链接器</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span>	MH_BUNDLE	0x8		<span class="comment">/* dynamically bound bundle file */</span>   <span class="comment">// bundle 文件</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span>	MH_DYLIB_STUB	0x9		<span class="comment">/* shared library stub for static */</span></span></div><div class="line">					<span class="comment">/*  linking only, no section contents */</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span>	MH_DSYM		0xa		<span class="comment">/* companion file with only debug */</span></span></div><div class="line">					<span class="comment">/*  sections */</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span>	MH_KEXT_BUNDLE	0xb		<span class="comment">/* x86_64 kexts */</span>  <span class="comment">//  内核扩展文件</span></span></div></pre></td></tr></table></figure>
<ul>
<li><code>Flags</code> : 指定了 dyld 的加载参数，其所有参数如下：</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* Constants for the flags field of the mach_header */</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span>	MH_NOUNDEFS	0x1		<span class="comment">/* the object file has no undefined</span></span></div><div class="line">					   references */</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span>	MH_INCRLINK	0x2		<span class="comment">/* the object file is the output of an</span></span></div><div class="line">					   incremental link against a base file</div><div class="line">					   and can't be link edited again */</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MH_DYLDLINK	0x4		<span class="comment">/* the object file is input for the</span></span></div><div class="line">					   dynamic linker and can't be staticly</div><div class="line">					   link edited again */</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MH_BINDATLOAD	0x8		<span class="comment">/* the object file's undefined</span></span></div><div class="line">					   references are bound by the dynamic</div><div class="line">					   linker when loaded. */</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MH_PREBOUND	0x10		<span class="comment">/* the file has its dynamic undefined</span></span></div><div class="line">					   references prebound. */</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MH_SPLIT_SEGS	0x20		<span class="comment">/* the file has its read-only and</span></span></div><div class="line">					   read-write segments split */</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MH_LAZY_INIT	0x40		<span class="comment">/* the shared library init routine is</span></span></div><div class="line">					   to be run lazily via catching memory</div><div class="line">					   faults to its writeable segments</div><div class="line">					   (obsolete) */</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MH_TWOLEVEL	0x80		<span class="comment">/* the image is using two-level name</span></span></div><div class="line">					   space bindings */</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MH_FORCE_FLAT	0x100		<span class="comment">/* the executable is forcing all images</span></span></div><div class="line">					   to use flat name space bindings */</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MH_NOMULTIDEFS	0x200		<span class="comment">/* this umbrella guarantees no multiple</span></span></div><div class="line">					   defintions of symbols in its</div><div class="line">					   sub-images so the two-level namespace</div><div class="line">					   hints can always be used. */</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MH_NOFIXPREBINDING 0x400	<span class="comment">/* do not have dyld notify the</span></span></div><div class="line">					   prebinding agent about this</div><div class="line">					   executable */</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MH_PREBINDABLE  0x800           <span class="comment">/* the binary is not prebound but can</span></span></div><div class="line">					   have its prebinding redone. only used</div><div class="line">                                           when MH_PREBOUND is not set. */</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MH_ALLMODSBOUND 0x1000		<span class="comment">/* indicates that this binary binds to</span></span></div><div class="line">                                           all two-level namespace modules of</div><div class="line">					   its dependent libraries. only used</div><div class="line">					   when MH_PREBINDABLE and MH_TWOLEVEL</div><div class="line">					   are both set. */ </div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MH_SUBSECTIONS_VIA_SYMBOLS 0x2000<span class="comment">/* safe to divide up the sections into</span></span></div><div class="line">					    sub-sections via symbols for dead</div><div class="line">					    code stripping */</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MH_CANONICAL    0x4000		<span class="comment">/* the binary has been canonicalized</span></span></div><div class="line">					   via the unprebind operation */</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MH_WEAK_DEFINES	0x8000		<span class="comment">/* the final linked image contains</span></span></div><div class="line">					   external weak symbols */</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MH_BINDS_TO_WEAK 0x10000	<span class="comment">/* the final linked image uses</span></span></div><div class="line">					   weak symbols */</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MH_ALLOW_STACK_EXECUTION 0x20000<span class="comment">/* When this bit is set, all stacks </span></span></div><div class="line">					   in the task will be given stack</div><div class="line">					   execution privilege.  Only used in</div><div class="line">					   MH_EXECUTE filetypes. */</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MH_ROOT_SAFE 0x40000           <span class="comment">/* When this bit is set, the binary </span></span></div><div class="line">					  declares it is safe for use in</div><div class="line">					  processes with uid zero */</div><div class="line">                                         </div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MH_SETUID_SAFE 0x80000         <span class="comment">/* When this bit is set, the binary </span></span></div><div class="line">					  declares it is safe for use in</div><div class="line">					  processes when issetugid() is true */</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MH_NO_REEXPORTED_DYLIBS 0x100000 <span class="comment">/* When this bit is set on a dylib, </span></span></div><div class="line">					  the static linker does not need to</div><div class="line">					  examine dependent dylibs to see</div><div class="line">					  if any are re-exported */</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span>	MH_PIE 0x200000			<span class="comment">/* When this bit is set, the OS will</span></span></div><div class="line">					   load the main executable at a</div><div class="line">					   random address.  Only used in</div><div class="line">					   MH_EXECUTE filetypes. */</div></pre></td></tr></table></figure>
<p>条目比较长，这里介绍几个常见的：</p>
<table>
<thead>
<tr>
<th>Flag Type</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>MH_NOUNDEFS</td>
<td>目标没有未定义的符号，不存在链接依赖</td>
</tr>
<tr>
<td>MH_DYLDLINK</td>
<td>该目标文件是 dyld 的输入文件，无法被再次的静态链接</td>
</tr>
<tr>
<td>MH_PIE</td>
<td>允许随机的地址空间</td>
</tr>
<tr>
<td>MH_ALLOW_STACK_EXECUTION</td>
<td>栈内存可执行代码，一般是默认关闭的</td>
</tr>
<tr>
<td>MH_NO_HEAP_EXECUTION</td>
<td>堆内存无法执行代码</td>
</tr>
<tr>
<td>MH_BINDS_TO_WEAK</td>
<td>最终链接文件包含弱符号</td>
</tr>
<tr>
<td>MH_WEAK_DEFINES</td>
<td>文件包含外部弱符号</td>
</tr>
<tr>
<td>MH_TWOLEVEL</td>
<td>两级名称空间绑定</td>
</tr>
</tbody>
</table>
<h3 id="0x03-Load-Commands"><a href="#0x03-Load-Commands" class="headerlink" title="0x03 Load Commands"></a>0x03 Load Commands</h3><p>其数据结构定义如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> load_command &#123;</div><div class="line">	<span class="keyword">uint32_t</span> cmd;		<span class="comment">/* type of load command */</span></div><div class="line">	<span class="keyword">uint32_t</span> cmdsize;	<span class="comment">/* total size of command in bytes */</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p><img src="/images/macho/loadcmd.jpg" alt=""></p>
<p>这些加载命令在 <code>Mach-O</code> 文件加载解析时，被内核加载器或者动态链接器调用，指导如何设置加载对应的二进制数据段。从内部逻辑来说，它是根据 <code>cmd</code> 的类型去调用相对应的函数来加载。以下列出一些常见的 <code>cmd</code> ：</p>
<table>
<thead>
<tr>
<th>Command类型</th>
<th>处理函数或结构体</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>LC_SEGMENT；LC_SEGMENT_64</td>
<td>load_segment</td>
<td>将 segment 中的数据加载并映射到进程的内存空间去</td>
</tr>
<tr>
<td>LC_LOAD_DYLINKER</td>
<td>load_dylinker</td>
<td>启动动态加载链接器 /usr/lib/dyld 程序</td>
</tr>
<tr>
<td>LC_UUID</td>
<td>load_uuid</td>
<td>加载128-bit的唯一ID，标示该二进制文件</td>
</tr>
<tr>
<td>LC_THREAD</td>
<td>load_thread</td>
<td>开启一个MACH线程，但是不分配栈空间。</td>
</tr>
<tr>
<td>LC_UNIXTHREAD</td>
<td>load_unixthread</td>
<td>开启一个UNIX线程</td>
</tr>
<tr>
<td>LC_CODE_SIGNATURE</td>
<td>load_code_signature</td>
<td>进行数字签名</td>
</tr>
<tr>
<td>LC_ENCRYPTION_INFO</td>
<td>set_code_unprotect</td>
<td>加密二进制文件</td>
</tr>
<tr>
<td>LC_SYMTAB</td>
<td></td>
<td>加载符号表和字符串表</td>
</tr>
<tr>
<td>LC_DYSYMTAB</td>
<td></td>
<td>动态符号表信息 创建导入表，包含符号表上已被加载的数据</td>
</tr>
<tr>
<td>LC_LOAD_DYLIB</td>
<td>struct dylib_command</td>
<td>加载的动态库，包括动态库地址、名称、版本号等</td>
</tr>
<tr>
<td>LC_FUNCTION_STARTS</td>
<td></td>
<td>函数地址起始表</td>
</tr>
<tr>
<td>LC_MAIN</td>
<td>struct entry_point_command</td>
<td>可执行文件的主函数main()的位置</td>
</tr>
</tbody>
</table>
<p>至于 <code>cmdsize</code> 字段是表示 <code>command</code> 整个大小，用于计算出到下一个 <code>command</code> 的偏移量。</p>
<h3 id="0x04-Segments"><a href="#0x04-Segments" class="headerlink" title="0x04 Segments"></a>0x04 Segments</h3><p>加载数据时，主要加载的就是 <code>LC_SEGMET</code> 或者 <code>LC_SEGMENT_64</code>，其数据结构定义如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> segment_command &#123; <span class="comment">/* for 32-bit architectures */</span></div><div class="line">	<span class="keyword">uint32_t</span>	cmd;		<span class="comment">/* LC_SEGMENT */</span></div><div class="line">	<span class="keyword">uint32_t</span>	cmdsize;	<span class="comment">/* includes sizeof section structs */</span></div><div class="line">	<span class="keyword">char</span>		segname[<span class="number">16</span>];	<span class="comment">/* segment name */</span></div><div class="line">	<span class="keyword">uint32_t</span>	vmaddr;		<span class="comment">/* memory address of this segment */</span></div><div class="line">	<span class="keyword">uint32_t</span>	vmsize;		<span class="comment">/* memory size of this segment */</span></div><div class="line">	<span class="keyword">uint32_t</span>	fileoff;	<span class="comment">/* file offset of this segment */</span></div><div class="line">	<span class="keyword">uint32_t</span>	filesize;	<span class="comment">/* amount to map from the file */</span></div><div class="line">	<span class="keyword">vm_prot_t</span>	maxprot;	<span class="comment">/* maximum VM protection */</span></div><div class="line">	<span class="keyword">vm_prot_t</span>	initprot;	<span class="comment">/* initial VM protection */</span></div><div class="line">	<span class="keyword">uint32_t</span>	nsects;		<span class="comment">/* number of sections in segment */</span></div><div class="line">	<span class="keyword">uint32_t</span>	flags;		<span class="comment">/* flags */</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">struct</span> segment_command_64 &#123; <span class="comment">/* for 64-bit architectures */</span></div><div class="line">	<span class="keyword">uint32_t</span>	cmd;		<span class="comment">/* LC_SEGMENT_64 */</span></div><div class="line">	<span class="keyword">uint32_t</span>	cmdsize;	<span class="comment">/* includes sizeof section_64 structs */</span></div><div class="line">	<span class="keyword">char</span>		segname[<span class="number">16</span>];	<span class="comment">/* segment name */</span></div><div class="line">	<span class="keyword">uint64_t</span>	vmaddr;		<span class="comment">/* memory address of this segment */</span></div><div class="line">	<span class="keyword">uint64_t</span>	vmsize;		<span class="comment">/* memory size of this segment */</span></div><div class="line">	<span class="keyword">uint64_t</span>	fileoff;	<span class="comment">/* file offset of this segment */</span></div><div class="line">	<span class="keyword">uint64_t</span>	filesize;	<span class="comment">/* amount to map from the file */</span></div><div class="line">	<span class="keyword">vm_prot_t</span>	maxprot;	<span class="comment">/* maximum VM protection */</span></div><div class="line">	<span class="keyword">vm_prot_t</span>	initprot;	<span class="comment">/* initial VM protection */</span></div><div class="line">	<span class="keyword">uint32_t</span>	nsects;		<span class="comment">/* number of sections in segment */</span></div><div class="line">	<span class="keyword">uint32_t</span>	flags;		<span class="comment">/* flags */</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>从定义可以看出它的大部分作用是定义了一些 <code>Mach-O</code> 文件的数据、地址和内存保护属性，这些数据在动态链接器加载程序时被映射到了虚拟内存中。主要要关注的是 <code>nsects</code> 字段，标示了 <code>Segment</code> 中有多少 <code>secetion</code>。 <code>section</code> 是具体有用的数据存放的地方。这里提一下 <code>vmaddr</code> 变量， <code>vmaddr</code> 段的虚存地址（未偏移），由于 <code>ALSR</code> ，程序会在进程加上一段偏移量（<code>slide</code>），真实的地址 <code>= vm address + slide</code> 。</p>
<p><code>LC_SEGMENT</code> 意味着这部分文件需要映射到进程的地址空间去。一般有以下段名：</p>
<ul>
<li><code>__PAGEZERO</code> :　空指针陷阱段，映射到虚拟内存空间的第一页，用于捕捉对 <code>NULL</code> 指针的引用。</li>
<li><code>__TEXT</code> :　包含了执行代码以及其他只读数据。该段数据可以 <code>VM_PROT_READ</code>(读)、<code>VM_PROT_EXECUTE</code>(执行)，不能被修改。</li>
<li><code>__DATA</code> :　程序数据，该段可写 <code>VM_PROT_WRITE/READ/EXECUTE</code>。</li>
<li><code>__LINKEDIT</code> :　包含需要被动态链接器使用的信息，包括符号表、字符串表、重定位项表等。</li>
</ul>
<h3 id="0x05-Section"><a href="#0x05-Section" class="headerlink" title="0x05 Section"></a>0x05 Section</h3><p><code>Section</code> 的数据结构如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> section &#123; <span class="comment">/* for 32-bit architectures */</span></div><div class="line">	<span class="keyword">char</span>		sectname[<span class="number">16</span>];	<span class="comment">/* name of this section */</span></div><div class="line">	<span class="keyword">char</span>		segname[<span class="number">16</span>];	<span class="comment">/* segment this section goes in */</span></div><div class="line">	<span class="keyword">uint32_t</span>	addr;		<span class="comment">/* memory address of this section */</span></div><div class="line">	<span class="keyword">uint32_t</span>	size;		<span class="comment">/* size in bytes of this section */</span></div><div class="line">	<span class="keyword">uint32_t</span>	offset;		<span class="comment">/* file offset of this section */</span></div><div class="line">	<span class="keyword">uint32_t</span>	align;		<span class="comment">/* section alignment (power of 2) */</span></div><div class="line">	<span class="keyword">uint32_t</span>	reloff;		<span class="comment">/* file offset of relocation entries */</span></div><div class="line">	<span class="keyword">uint32_t</span>	nreloc;		<span class="comment">/* number of relocation entries */</span></div><div class="line">	<span class="keyword">uint32_t</span>	flags;		<span class="comment">/* flags (section type and attributes)*/</span></div><div class="line">	<span class="keyword">uint32_t</span>	reserved1;	<span class="comment">/* reserved (for offset or index) */</span></div><div class="line">	<span class="keyword">uint32_t</span>	reserved2;	<span class="comment">/* reserved (for count or sizeof) */</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">struct</span> section_64 &#123; <span class="comment">/* for 64-bit architectures */</span></div><div class="line">	<span class="keyword">char</span>		sectname[<span class="number">16</span>];	<span class="comment">/* name of this section */</span></div><div class="line">	<span class="keyword">char</span>		segname[<span class="number">16</span>];	<span class="comment">/* segment this section goes in */</span></div><div class="line">	<span class="keyword">uint64_t</span>	addr;		<span class="comment">/* memory address of this section */</span></div><div class="line">	<span class="keyword">uint64_t</span>	size;		<span class="comment">/* size in bytes of this section */</span></div><div class="line">	<span class="keyword">uint32_t</span>	offset;		<span class="comment">/* file offset of this section */</span></div><div class="line">	<span class="keyword">uint32_t</span>	align;		<span class="comment">/* section alignment (power of 2) */</span></div><div class="line">	<span class="keyword">uint32_t</span>	reloff;		<span class="comment">/* file offset of relocation entries */</span></div><div class="line">	<span class="keyword">uint32_t</span>	nreloc;		<span class="comment">/* number of relocation entries */</span></div><div class="line">	<span class="keyword">uint32_t</span>	flags;		<span class="comment">/* flags (section type and attributes)*/</span></div><div class="line">	<span class="keyword">uint32_t</span>	reserved1;	<span class="comment">/* reserved (for offset or index) */</span></div><div class="line">	<span class="keyword">uint32_t</span>	reserved2;	<span class="comment">/* reserved (for count or sizeof) */</span></div><div class="line">	<span class="keyword">uint32_t</span>	reserved3;	<span class="comment">/* reserved */</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>除了同样有帮助内存映射的变量外，在了解 <code>Mach-O</code> 格式的时候，只需要知道不同的 <code>Section</code> 有着不同的作用就可以了。</p>
<p>之所以按照“段-节”的方式组织，是因为同一个段下的节，在内存的权限相同，可以不完全按照页大小进行对齐，节省内存空间。而对外整体暴露段，在装载程序的时候完整映射成一个 <code>vma</code> ，可以更好的做内存对齐。</p>
<table>
<thead>
<tr>
<th>Section</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Text.__text</code></td>
<td>主程序代码</td>
</tr>
<tr>
<td><code>Text.__stubs</code></td>
<td>符号桩。本质上是一小段会直接跳入 <code>lazybinding</code> 的表对应项指针指向的地址的代码</td>
</tr>
<tr>
<td><code>Text.__stub_helper</code></td>
<td>用于动态链接的存根。上述提到的 <code>lazybinding</code> 的表中对应项的指针在没有找到真正的符号地址的时候，都指向这。</td>
</tr>
<tr>
<td><code>Text.__objc_methname</code></td>
<td>方法名列表</td>
</tr>
<tr>
<td><code>Text.__objc_classname</code></td>
<td>类名列表</td>
</tr>
<tr>
<td><code>Text.__objc_methtype</code></td>
<td>方法签名列表</td>
</tr>
<tr>
<td><code>Text.__cstring</code></td>
<td>c 字符串</td>
</tr>
<tr>
<td><code>Data.__const</code></td>
<td>没有初始化过的常量</td>
</tr>
<tr>
<td><code>Data.__objc_classlist</code></td>
<td>类列表</td>
</tr>
<tr>
<td><code>Data.__objc_nlclslist</code></td>
<td><code>Objective-C</code> 的 <code>+load</code> 函数列表，比 <code>__mod_init_func</code> 更早执行</td>
</tr>
<tr>
<td><code>Data.__data</code></td>
<td>初始化可变的数据</td>
</tr>
<tr>
<td><code>Data._got</code></td>
<td>存储引用符号的实际地址，类似于动态符号表</td>
</tr>
<tr>
<td><code>Data.__cfstring</code></td>
<td><code>Core Foundation</code> 用到的字符串（OC字符串）</td>
</tr>
<tr>
<td><code>Data.__objc_imageinfo</code></td>
<td>镜像信息</td>
</tr>
<tr>
<td><code>Data.__la_symbol_ptr</code></td>
<td>懒加载符号指针表，通过 <code>dyld_stub_binder</code> 辅助链接</td>
</tr>
<tr>
<td><code>Data.__nl_symbol_ptr</code></td>
<td>非懒加载符号指针表</td>
</tr>
<tr>
<td><code>Data.__mod_init_func</code></td>
<td>初始化的全局函数地址，在 <code>main</code> 之前被调用</td>
</tr>
<tr>
<td><code>Data.__mod_term_func</code></td>
<td>终止函数，在main返回之后调用</td>
</tr>
<tr>
<td><code>Data.__objc_const</code></td>
<td><code>Objective-C</code> 的常量</td>
</tr>
<tr>
<td><code>Data.__objc_selrefs</code></td>
<td>所有被使用的方法的引用</td>
</tr>
</tbody>
</table>
<h3 id="0x06-二进制文件符号查找"><a href="#0x06-二进制文件符号查找" class="headerlink" title="0x06 二进制文件符号查找"></a>0x06 二进制文件符号查找</h3><p>我们可以结合 <code>fishhook</code> 的一张图来分析。</p>
<p><img src="/images/macho/fishhook.png" alt=""></p>
<p>这张图初看很复杂，不过它演示的是寻找符号的过程，我们根据这张图来分析一下这个过程：</p>
<ol>
<li>从 <code>__DATA</code> 段中的 <code>lazy</code> 符号指针表中查找某个符号，获得这个符号的偏移量 1061 ，然后在每一个 <code>section_64</code> 中查找 <code>reserved1</code> ，通过这两个值找到 <code>Indirect Symbol Table</code> 中符号对应的条目</li>
<li>在 <code>Indirect Symbol Table</code> 找到符号表指针以及对应的索引 16343 之后，就需要访问符号表</li>
<li>然后通过符号表中的偏移量，获取字符串表中的符号 <code>_close</code></li>
</ol>
<p>从代码角度来看，整个过程大致是这样的。首先从镜像中查找 <code>linkedit_segment</code> <code>symtab_command</code> 和 <code>dysymtab_command</code> ；在开始查找之前，要先跳过 <code>mach_header_t</code> 长度的位置，然后将当前指针强转成 <code>segment_command_t</code> ，通过对比 <code>cmd</code> 的值，来找到需要的 <code>segment_command_t</code> 。在 <code>linkedit_segment</code> 结构体中获得其虚拟地址以及文件偏移量，然后通过一下公式来计算当前 <code>__LINKEDIT</code> 段的位置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">slide + vmaffr - fileoff</div></pre></td></tr></table></figure>
<p>类似地，在 <code>symtab_command</code> 中获取符号表偏移量和字符串表偏移量，从 <code>dysymtab_command</code> 中获取间接符号表（<code>indirect symbol table</code>）偏移量，就能够获得<em>符号表</em>、<em>字符串表</em>以及<em>间接符号表</em>的引用了。</p>
<ul>
<li>间接符号表中的元素都是 <code>uint32_t *</code>，指针的值是对应条目 <code>n_list</code> 在符号表中的位置</li>
<li>符号表中的元素都是 <code>nlist_t</code> 结构体，其中包含了当前符号在字符串表中的下标</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> nlist_64 &#123;</div><div class="line">    <span class="keyword">union</span> &#123;</div><div class="line">    	<span class="keyword">uint32_t</span>  n_strx; <span class="comment">/* index into the string table */</span></div><div class="line">	&#125; n_un;</div><div class="line">	<span class="keyword">uint8_t</span> n_type;        <span class="comment">/* type flag, see below */</span></div><div class="line">	<span class="keyword">uint8_t</span> n_sect;        <span class="comment">/* section number or NO_SECT */</span></div><div class="line">	<span class="keyword">uint16_t</span> n_desc;       <span class="comment">/* see &lt;mach-o/stab.h&gt; */</span></div><div class="line">	<span class="keyword">uint64_t</span> n_value;      <span class="comment">/* value of this symbol (or stab offset) */</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<ul>
<li>字符串表中的元素是 <code>char</code> 字符</li>
</ul>
<p>总结一下就是：</p>
<ol>
<li>通过 i<code>ndirect_symtab + section-&gt;reserved1</code> 获取 <code>indirect_symbol_indices *</code>，也就是符号表的数组</li>
<li>通过 <code>(void **)((uintptr_t)slide + section-&gt;addr)</code> 获取函数指针列表 <code>indirect_symbol_bindings</code></li>
<li>遍历符号表数组 <code>indirect_symbol_indices *</code> 中的所有符号表中，获取其中的符号表索引 <code>symtab_index</code></li>
<li>通过符号表索引 <code>symtab_index</code> 获取符号表中某一个 <code>n_list</code> 结构体，得到字符串表中的索引 <code>symtab[symtab_index].n_un.n_strx</code></li>
<li>最后在字符串表中获得符号的名字 <code>char *symbol_name</code></li>
</ol>
<p>以上就是查找符号的整个过程。不过，以上的过程有个限定条件，那就是该符号是存在于外部动态链接库中的。如果你所要查找的符号包含于当前的镜像中，则不需要 <code>dyld</code> 解决函数地址的问题，它是直接从其他代码地址跳转到了当前函数的实现中。</p>
<h3 id="0x07-总结"><a href="#0x07-总结" class="headerlink" title="0x07 总结"></a>0x07 总结</h3><p>要想继续深入 iOS 底层，<code>Mach-O</code> 是绕不开的一环。深入了解 <code>Mach-O</code> 后，为后续安装包瘦身，动态修改函数指针等打下坚实的基础。</p>
<h3 id="0x08-参考"><a href="#0x08-参考" class="headerlink" title="0x08 参考"></a>0x08 参考</h3><p><a href="https://feicong.github.io/2017/01/13/macho/" target="_blank" rel="external">Mach-O文件格式</a><br><a href="https://opensource.apple.com/source/xnu/xnu-1228.15.4/EXTERNAL_HEADERS/mach-o/loader.h.auto.html" target="_blank" rel="external">Apple Open Source</a><br><a href="https://draveness.me/fishhook" target="_blank" rel="external">动态修改 C 语言函数的实现</a><br><a href="https://amywushu.github.io/2017/02/27/%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0-Hook-%E5%8E%9F%E7%90%86%E4%B9%8B-fishhook-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90.html" target="_blank" rel="external">Hook 原理之 fishhook 源码解析</a></p>

    </article>
    <!-- license  -->
    
        <div class="license-wrapper">
            <p>原文作者：<a href="https://kealdishx.github.io">Kealdishx</a>
            <p>原文链接：<a href="https://kealdishx.github.io/2018/11/10/analyzeMachoFile/">https://kealdishx.github.io/2018/11/10/analyzeMachoFile/</a>
            <p>发表日期：<a href="https://kealdishx.github.io/2018/11/10/analyzeMachoFile/">十一月 10日 2018, 6:51:04 晚上</a>
            <p>更新日期：<a href="https://kealdishx.github.io/2018/11/10/analyzeMachoFile/">February 20th 2019, 6:30:28 pm</a>
            <p>版权声明：本文采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p>
        </div>
    
    <!-- paginator  -->
    <ul class="post-paginator">
        <li class="next">
            
        </li>
        <li class="previous">
            
                <div class="prevSlogan">Previous Post</div>
                <a href= "/2018/10/24/protocolExtension/" title= "为 Objective-C 下的 protocol 添加默认实现">
                    <div class="prevTitle">为 Objective-C 下的 protocol 添加默认实现</div>
                </a>
            
        </li>
    </ul>
    <!-- 评论插件 -->
    <!-- 来必力City版安装代码 -->

<!-- City版安装代码已完成 -->
    
    <div id="disqus_thread"></div>
    <script>
        /**
    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
        
        var disqus_config = function () {
        this.page.url = "https://kealdishx.github.io/2018/11/10/analyzeMachoFile/";  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = "Mach-O 文件解析"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
        };
        
        (function () { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');
            s.src = 'https://iiiCeBlink.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();

    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    
    <!-- partial('_partial/comment/changyan') -->
    <!--PC版-->


    
    

    <!-- 评论 -->
</main>
            <!-- profile -->
            
        </div>
        <footer class="footer footer-unloaded">
    <!-- social  -->
    
    <div class="social">
        
    
        
            
                <a href="mailto:zakariyyasv@gmail.com" class="iconfont-archer email" title=email ></a>
            
        
    
        
            
                <a href="//github.com/iiiceblink" class="iconfont-archer github" target="_blank" title=github></a>
            
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            
                <a href="/atom.xml" class="iconfont-archer rss" target="_blank" title=rss></a>
            
        
    

    </div>
    
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- 不蒜子  -->
    
</footer>
    </div>
    <!-- toc -->
    
    <div class="toc-wrapper" style=
    







top:50vh;

    >
        <div class="toc-catalog">
            <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
        </div>
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x00-概要"><span class="toc-number">1.</span> <span class="toc-text">0x00 概要</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x01-Fat-Header"><span class="toc-number">2.</span> <span class="toc-text">0x01 Fat Header</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x02-Header"><span class="toc-number">3.</span> <span class="toc-text">0x02 Header</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x03-Load-Commands"><span class="toc-number">4.</span> <span class="toc-text">0x03 Load Commands</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x04-Segments"><span class="toc-number">5.</span> <span class="toc-text">0x04 Segments</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x05-Section"><span class="toc-number">6.</span> <span class="toc-text">0x05 Section</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x06-二进制文件符号查找"><span class="toc-number">7.</span> <span class="toc-text">0x06 二进制文件符号查找</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x07-总结"><span class="toc-number">8.</span> <span class="toc-text">0x07 总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x08-参考"><span class="toc-number">9.</span> <span class="toc-text">0x08 参考</span></a></li></ol>
    </div>
    
    <div class="back-top iconfont-archer">&#xe639;</div>
    <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
          <div class="sidebar-panel-archives">
    <!-- 在ejs中将archive按照时间排序 -->
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <div class="total-and-search">
        <div class="total-archive">
        Total : 35
        </div>
        <!-- search  -->
        
    </div>
    
    <div class="post-archive">
    
    
    
    
    <div class="archive-year"> 2018 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/10</span><a class="archive-post-title" href= "/2018/11/10/analyzeMachoFile/" >Mach-O 文件解析</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/24</span><a class="archive-post-title" href= "/2018/10/24/protocolExtension/" >为 Objective-C 下的 protocol 添加默认实现</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/22</span><a class="archive-post-title" href= "/2018/10/22/HowMirrorWorks/" >反射如何工作</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/12</span><a class="archive-post-title" href= "/2018/09/12/利用KVO解决swizzle失效问题/" >利用 KVO 解决 swizzle 失效问题</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> 2017 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/18</span><a class="archive-post-title" href= "/2017/11/18/探究 iOS 11 下的 UIDebuggingInformationOverlay/" >探究 iOS 11 下的 UIDebuggingInformationOverlay</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/04</span><a class="archive-post-title" href= "/2017/10/04/Weak 属性在 dealloc 背后的逻辑/" >Weak 属性在 dealloc() 背后的逻辑</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> 2016 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/10</span><a class="archive-post-title" href= "/2016/10/10/CFNetwork学习笔记（四）/" >CFNetwork学习笔记（四）</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/07</span><a class="archive-post-title" href= "/2016/10/07/CFNetwork学习笔记（三）/" >CFNetwork学习笔记（三）</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/06</span><a class="archive-post-title" href= "/2016/10/06/CFNetwork学习笔记（二）/" >CFNetwork学习笔记（二）</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/05</span><a class="archive-post-title" href= "/2016/10/05/CFNetwork学习笔记（一）/" >CFNetwork学习笔记（一）</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/03</span><a class="archive-post-title" href= "/2016/10/03/dumpdecrypted砸壳记录/" >dumpdecrypted砸壳记录</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/20</span><a class="archive-post-title" href= "/2016/09/20/iOS OpenDev踩坑记录/" >iOS OpenDev踩坑记录</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/18</span><a class="archive-post-title" href= "/2016/09/18/iOS APP砸壳小记/" >iOS APP砸壳小记</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/04</span><a class="archive-post-title" href= "/2016/09/04/iOS APP中调用私有方法/" >iOS APP中调用私有方法</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/24</span><a class="archive-post-title" href= "/2016/08/24/拆解ARC下的self/" >拆解ARC下的self</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">07/30</span><a class="archive-post-title" href= "/2016/07/30/CallKit学习笔记/" >CallKit学习笔记</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">07/26</span><a class="archive-post-title" href= "/2016/07/26/iOS 10推送通知小记（下）/" >iOS 10推送通知小记（下）</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">07/23</span><a class="archive-post-title" href= "/2016/07/23/iOS 10推送通知小记（上）/" >iOS 10推送通知小记（上）</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">07/18</span><a class="archive-post-title" href= "/2016/07/18/iOS 10 UICollectionView新特性小记/" >iOS 10 UICollectionView新特性小记</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/20</span><a class="archive-post-title" href= "/2016/05/20/H5游戏接入技术小结（下）/" >H5游戏接入技术小结（下）</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/17</span><a class="archive-post-title" href= "/2016/05/17/H5游戏接入技术小结（上）/" >H5游戏接入技术小结（上）</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/23</span><a class="archive-post-title" href= "/2016/04/23/庖丁解牛KVO（二）——KVO实现原理/" >庖丁解牛KVO（二）——KVO实现原理</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/13</span><a class="archive-post-title" href= "/2016/04/13/庖丁解牛KVO（一）——KVO概览和使用/" >庖丁解牛KVO（一）——KVO概览和使用</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/21</span><a class="archive-post-title" href= "/2016/03/21/UIScrollView实践小记——分页/" >【转】UIScrollView实践小记——分页</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/12</span><a class="archive-post-title" href= "/2016/03/12/Mac workflow小记/" >Mac workflow小记</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/12</span><a class="archive-post-title" href= "/2016/03/12/抽丝剥茧之block（上）/" >抽丝剥茧之block（上）</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/10</span><a class="archive-post-title" href= "/2016/03/10/深入理解NSMapTable、NSHashTable、NSPointerArray/" >深入理解NSMapTable、NSHashTable、NSPointerArray</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/06</span><a class="archive-post-title" href= "/2016/03/06/YYCache源码学习/" >YYCache源码学习</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">02/20</span><a class="archive-post-title" href= "/2016/02/20/runtime对containsString方法的小改进/" >runtime对containsString方法的小改进</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">01/14</span><a class="archive-post-title" href= "/2016/01/14/ApplePay线上支付教程/" >ApplePay线上支付教程</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> 2015 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">12/28</span><a class="archive-post-title" href= "/2015/12/28/UIButton之titleLabel、imageView解析/" >UIButton之titleLabel、imageView解析</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">12/17</span><a class="archive-post-title" href= "/2015/12/17/UICollectionView Layout学习笔记/" >UICollectionView Layout学习笔记</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/20</span><a class="archive-post-title" href= "/2015/10/20/UIImage加载图片方式的研究/" >UIImage加载图片方式的研究</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/18</span><a class="archive-post-title" href= "/2015/10/18/Xcode-Target、Project、WorkSpace、Scheme/" >Xcode-Target、Project、WorkSpace、Scheme</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/24</span><a class="archive-post-title" href= "/2015/09/24/UINavigationBar背景色设置/" >UINavigationBar背景色设置</a>
        </li>
    
    </div>
  </div>
        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
    
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
    缺失模块。<br/>
    1、请确保node版本大于6.2<br/>
    2、在博客根目录（注意不是archer根目录）执行以下命令：<br/>
    <span style="color: #f75357; font-size: 1rem; line-height: 2rem;">npm i hexo-generator-json-content --save</span><br/>
    3、在根目录_config.yml里添加配置：
    <pre style="color: #787878; font-size: 0.6rem;">
jsonContent:
  meta: false
  pages: false
  posts:
    title: true
    date: true
    path: true
    text: false
    raw: false
    content: false
    slug: false
    updated: false
    comments: false
    link: false
    permalink: false
    excerpt: false
    categories: true
    tags: true</pre>
    </div> 
    <div class="sidebar-tags-list"></div>
</div>
        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
    
        <span class="sidebar-category-name" data-categories="iOS"><span class="iconfont-archer">&#xe60a;</span>iOS</span>
    
        <span class="sidebar-category-name" data-categories="MacOS"><span class="iconfont-archer">&#xe60a;</span>MacOS</span>
    
        <span class="sidebar-category-name" data-categories="Mac相关"><span class="iconfont-archer">&#xe60a;</span>Mac相关</span>
    
        <span class="sidebar-category-name" data-categories="开发工具"><span class="iconfont-archer">&#xe60a;</span>开发工具</span>
    
        <span class="sidebar-category-name" data-categories="iOS逆向工程"><span class="iconfont-archer">&#xe60a;</span>iOS逆向工程</span>
    
        <span class="sidebar-category-name" data-categories="macOS"><span class="iconfont-archer">&#xe60a;</span>macOS</span>
    
        <span class="sidebar-category-name" data-categories="macOS/iOS"><span class="iconfont-archer">&#xe60a;</span>macOS/iOS</span>
    
        <span class="sidebar-category-name" data-categories="翻译"><span class="iconfont-archer">&#xe60a;</span>翻译</span>
    
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>
    </div>
</div> 
    <script>
    var siteMeta = {
        root: "/",
        author: "Kealdishx"
    }
</script>
    <!-- CDN failover -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
    <script type="text/javascript">
        if (typeof window.$ === 'undefined')
        {
            console.warn('jquery load from jsdelivr failed, will load local script')
            document.write('<script src="/lib/jquery.min.js">\x3C/script>')
        }
    </script>
    <script src="/scripts/main.js"></script>
    <!-- algolia -->
    
    <!-- busuanzi  -->
    
    <!-- CNZZ  -->
    
    </div>
    <!-- async load share.js -->
    
        <script src="/scripts/share.js" async></script>    
     
    </body>
</html>


